![](http://yano.oss-cn-beijing.aliyuncs.com/2020-12-10-070550.jpg)

- [前言](#前言)
  - [协程是什么](#协程是什么)
  - [协程的好处](#协程的好处)
- [进程](#进程)
  - [进程是什么](#进程是什么)
  - [进程组成](#进程组成)
  - [进程特征](#进程特征)
- [线程](#线程)
  - [线程是什么](#线程是什么)
  - [线程组成](#线程组成)
  - [任务调度](#任务调度)
  - [进程与线程的区别](#进程与线程的区别)
  - [线程的实现模型](#线程的实现模型)
    - [1:1线程模型](#11线程模型)
    - [N:1线程模型](#n1线程模型)
    - [N:M线程模型](#nm线程模型)
- [参考资料](#参考资料)

# 前言

Go 语言比 Java 语言性能优越的一个原因，就是轻量级线程`Goroutines`（协程Coroutine）。本篇文章深入分析下 Java 的线程和 Go 的协程。

## 协程是什么

协程并不是 Go 提出来的新概念，其他的一些编程语言，例如：Go、Python 等都可以在语言层面上实现协程，甚至是 Java，也可以通过使用扩展库来间接地支持协程。

当在网上搜索协程时，我们会看到：

- Kotlin 官方文档说「本质上，协程是轻量级的线程」。
- 很多博客提到「不需要从用户态切换到内核态」、「是协作式的」等等。

「协程 Coroutines」源自 Simula 和 Modula-2 语言，这个术语早在 1958 年就被 Melvin Edward Conway 发明并用于构建汇编程序，说明协程是一种编程思想，并不局限于特定的语言。

## 协程的好处

性能比 Java 好很多，甚至代码实现都比 Java 要简洁很多。

那这究竟又是为什么呢？下面一一分析。

说明：下面关于进程和线程的部分，几乎完全参考自：https://www.cnblogs.com/Survivalist/p/11527949.html，这篇文章写得太好了~~~

# 进程

## 进程是什么

计算机的核心是 CPU，执行所有的计算任务；操作系统负责任务的调度、资源的分配和管理；应用程序是具有某种功能的程序，程序是运行在操作系统上的。

进程是一个具有一定独立功能的程序在一个数据集上的一次动态执行的过程，是操作系统进行资源分配和调度的一个独立单位，是应用程序运行的载体。

## 进程组成

进程由三部分组成：

- `程序`：描述进程要完成的功能，是控制进程执行的指令集。
- `数据集合`：程序在执行时所需要的数据和工作区。
- `进程控制块`：(Program Control Block，简称PCB)，包含进程的描述信息和控制信息，是进程存在的唯一标志。

## 进程特征

- 动态性：进程是程序的一次执行过程，是临时的，有生命期的，是动态产生，动态消亡的。
- 并发性：任何进程都可以同其他进程一起并发执行。
- 独立性：进程是系统进行资源分配和调度的一个独立单位。
- 结构性：进程由程序、数据和进程控制块三部分组成。

# 线程

## 线程是什么

线程是程序执行中一个单一的`顺序控制流程`，是`程序执行流的最小单元`，是`处理器调度和分派的基本单位`。一个进程可以有一个或多个线程，各个线程之间`共享程序的内存空间`(也就是所在进程的内存空间)。

## 线程组成

- 线程ID、当前指令指针(PC)
- 寄存器
- 堆栈

## 任务调度

大部分操作系统(如Windows、Linux)的任务调度是采用`时间片轮转的抢占式调度方式`。

在一个进程中，当一个线程任务执行几毫秒后，会由操作系统的内核（负责管理各个任务）进行调度，通过硬件的计数器中断处理器，让该线程强制暂停并将该线程的寄存器放入内存中，通过查看线程列表决定接下来执行哪一个线程，并从内存中恢复该线程的寄存器，最后恢复该线程的执行，从而去执行下一个任务。

## 进程与线程的区别

- 线程是程序执行的最小单位，而进程是操作系统分配资源的最小单位；
- 一个进程由一个或多个线程组成，`线程是一个进程中代码的不同执行路线`；
- 进程之间相互独立，但同一进程下的各个线程之间共享程序的内存空间(包括代码段、数据集、堆等)及一些进程级的资源(如打开文件和信号)，某进程内的线程在其它进程不可见；
- 调度和切换：`线程上下文切换`比`进程上下文切换`要`快`得多。

![](http://yano.oss-cn-beijing.aliyuncs.com/2020-12-10-120038.jpg)

## 线程的实现模型

程序一般不会直接去使用内核线程，而是去使用内核线程的一种高级接口——`轻量级进程（Lightweight Process，LWP）`，轻量级进程就是我们通常意义上所讲的线程，也被叫做用户线程。

### 1:1线程模型

### N:1线程模型

### N:M线程模型

# 参考资料

- 极客时间-Java性能调优实战/19.如何用协程来优化多线程业务？
- https://www.cnblogs.com/Survivalist/p/11527949.html
- https://www.jianshu.com/p/5db701a764cb
- 